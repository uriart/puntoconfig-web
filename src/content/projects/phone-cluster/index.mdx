---
title: "üì± Kube-Phone: Un cl√∫ster de Kubernetes con smartphones viejos"
description: "Reciclando hardware m√≥vil para montar un cl√∫ster K3s multi-arquitectura (ARMv7 y Aarch64) con PostmarketOS."
date: "2025-10-09"
---

import { Image } from "astro:assets";
import phoneCluster from "./phone-cluster.jpg";

¬øQu√© haces con esos m√≥viles que tienes olvidados en un caj√≥n? En este proyecto, convert√≠ tres smartphones antiguos en un cl√∫ster de Kubernetes completamente funcional. Es una forma excelente de aprender sobre **arquitecturas ARM**, **redes bare-metal** y **alta disponibilidad** con un consumo energ√©tico m√≠nimo.

<Image
  src={phoneCluster}
  alt="Phone cluster"
  width={600}
  height={400}
  format="webp"
/>

## üõ†Ô∏è Fase 1: El Sistema Operativo (PostmarketOS)

Para que un m√≥vil se comporte como un servidor real, necesitamos un Linux "de verdad". [PostmarketOS](https://postmarketos.org/) es una distribuci√≥n basada en Alpine Linux optimizada para dispositivos t√°ctiles, pero que brilla en su versi√≥n de consola.

### Hardware utilizado
- **Master (POCO F1):** Arquitectura `Aarch64` (Potencia de sobra para el control-plane).
- **Worker 1 (Google Nexus 5):** Arquitectura `Armv7` (Un veterano que a√∫n da guerra).
- **Worker 2 (Xiaomi Mi 6):** Actualmente fuera de servicio, pero listo para escalar.

> **‚ö†Ô∏è Importante:** Antes de empezar, debes desbloquear el bootloader de cada dispositivo. Es un proceso que puede variar seg√∫n la marca y conlleva riesgos.

### Instalaci√≥n clave
Durante el asistente de instalaci√≥n de postmarketOS, es vital seleccionar la interfaz **`console`**. No queremos malgastar RAM en un entorno gr√°fico que no vamos a ver. Una vez flasheado, accedemos por SSH mediante la IP de emergencia v√≠a USB:

```bash
ssh user@172.16.42.1
```
Tip de PuntoConfig: Desactiva el firewall temporalmente para evitar que nftables bloquee el tr√°fico interno del cl√∫ster mientras configuras los nodos.

## Fase 2: El Cl√∫ster (K3s)
He elegido K3s de Rancher por ser la distribuci√≥n de Kubernetes m√°s ligera y eficiente para dispositivos con recursos limitados.

### Instalaci√≥n del Master y Workers
El proceso es extremadamente sencillo gracias al script oficial:

*   En el Master: Ejecuta el instalador y recupera el `node-token` en `/var/lib/rancher/k3s/server/node-token`.
*   En los Workers: Lanza el script apuntando a la IP del Master y usando el token obtenido.

> **‚ÑπÔ∏è Ojo con el Kubeconfig:** Al descargar el archivo `/etc/rancher/k3s/k3s.yaml` a tu PC local, recuerda cambiar `127.0.0.1` por la IP privada de tu dispositivo master para poder usar `kubectl` desde fuera.

### El reto de la Multi-Arquitectura
Este cl√∫ster es un h√≠brido. El POCO F1 es 64 bits (`aarch64`) y el Nexus 5 es 32 bits (`armv7`). Al desplegar aplicaciones, debes usar im√°genes multi-arch. Si intentas ejecutar un contenedor de 64 bits en el Nexus 5, el Pod fallar√° con un error de ejecuci√≥n.

## Fase 3: Networking y Acceso Externo
Aqu√≠ tenemos dos caminos seg√∫n tus necesidades:

### Opci√≥n A: Cloudflare Tunnel (Acceso P√∫blico)
Ideal para exponer el cl√∫ster sin abrir puertos en tu router. Como el Nexus 5 es `armv7`, la imagen oficial de `cloudflared` no funcionar√°. Debemos usar una compatible en nuestro deployment: `ghcr.io/brenner-tobias/cloudflared/armv7`.

### Opci√≥n B: MetalLB (Acceso Local)
Si prefieres mantenerlo todo en tu red local con IPs virtuales, MetalLB es la soluci√≥n. Se encarga de asignar una IP de tu rango LAN (ej. `192.168.1.240`) a tu Ingress Controller.

## Fase 4: Tr√°fico con Traefik e Ingress
K3s viene con Traefik instalado por defecto. Para asegurar que nuestro cl√∫ster no caiga si reiniciamos un m√≥vil, escalamos el despliegue a alta disponibilidad:

````bash
kubeclt edit deployment traefik -n kube-system
# Cambia spec.replicas a 2
````
De esta forma, si el Nexus 5 se desconecta, el Master seguir√° sirviendo tr√°fico a trav√©s de su propia instancia de Traefik.

## Fase 5: Visualizaci√≥n con Kite Dashboard
Para gestionar el cl√∫ster visualmente sin estar pegado a la terminal, instal√© Kite Dashboard. Es extremadamente ligero, perfecto para este setup.

### Instalaci√≥n con Helm:
````bash
helm repo add kite https://zxh326.github.io/kite/
helm install kite kite/kite --set basePath=/kite --namespace default
````
Finalmente, creamos un Ingress para mapear nuestro dominio (ej. `cluster.puntoconfig.dev/kite`) hacia el servicio de Kite.

## Conclusi√≥n
Ver este cl√∫ster funcionar es casi m√°gico. Tenemos dispositivos de hace m√°s de 10 a√±os trabajando en conjunto, repartiendo carga y respondiendo a peticiones de internet.

¬øMerece la pena? Como entorno de producci√≥n, no. Como laboratorio de aprendizaje de Kubernetes, arquitecturas ARM y optimizaci√≥n de recursos, es inmejorable.

> **üí° Tip Final:** ¬øTienes un m√≥vil viejo por casa? ¬°No lo tires! Convi√©rtelo en tu primer nodo de Kubernetes.

---
## üìö Fuentes y Herramientas

Para la realizaci√≥n de este proyecto se han consultado las siguientes fuentes oficiales y utilizado las siguientes herramientas de la comunidad:

### Sistemas y Wiki
* **[PostmarketOS Wiki](https://wiki.postmarketos.org/wiki/Devices)**: Referencia principal para la compatibilidad de dispositivos (Xiaomi POCO F1, Nexus 5, Mi 6).
* **[PostmarketOS Installation Guide](https://wiki.postmarketos.org/wiki/Installation)**: Documentaci√≥n oficial para el flasheo e inicializaci√≥n.
* **[Unlocking Bootloaders](https://wiki.postmarketos.org/wiki/Unlocking_Bootloaders)**: Gu√≠a esencial de seguridad y desbloqueo.

### Kubernetes (K3s) y Networking
* **[K3s Official Documentation](https://docs.k3s.io/quick-start)**: Instalaci√≥n ligera de Kubernetes.
* **[MetalLB Project](https://metallb.io/)**: Balanceador de carga para entornos bare-metal.
* **[Cloudflare Tunnel Deployment](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/deployment-guides/kubernetes/)**: Gu√≠a para exponer servicios sin abrir puertos.
* **[Traefik Ingress Controller](https://doc.traefik.io/traefik/)**: Gesti√≥n de tr√°fico y proxy inverso.

### Herramientas de Gesti√≥n y Seguridad
* **[Kite Dashboard](https://github.com/zxh326/kite)**: Interfaz web ligera para visualizaci√≥n del cl√∫ster.
* **[How to Secure a Linux Server](https://github.com/imthenachoman/How-To-Secure-A-Linux-Server)**: Gu√≠a recomendada de securizaci√≥n (Hardening).

### Software de Control
* **[kubectl](https://kubernetes.io/docs/reference/kubectl/)**: L√≠nea de comandos de Kubernetes.
* **[k9s](https://k9scli.io/)**: Interfaz de terminal (TUI) para gestionar el cl√∫ster con estilo.