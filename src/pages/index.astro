---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { SITE, HOME, SOCIALS } from "@consts";

const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter(project => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <section class="animate space-y-4 pt-8">
      <div class="flex items-center gap-4">
        <div class="size-14 rounded-xl bg-[#cba6f7] flex items-center justify-center text-2xl shadow-lg shadow-[#cba6f7]/20">
          ⚙️
        </div>
        <h4 class="font-bold text-2xl text-[#4c4f69] dark:text-[#cdd6f4]">
          PuntoConfig<span class="text-[#8839ef] dark:text-[#cba6f7]">.dev</span>
        </h4>
      </div>
      
      <article class="space-y-4">
        <p class="animate text-lg">
          Bienvenido a mi laboratorio. Aquí comparto <strong>consejos técnicos reales</strong>, configuraciones optimizadas y guías paso a paso para dominar tu entorno digital. Sin ruido, solo lo que funciona.
        </p>
      </article>
    </section>

    <div class="space-y-16 py-12">
      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between border-b border-[#dce0e8] dark:border-[#313244] pb-2">
          <h5 class="font-bold text-[#4c4f69] dark:text-[#cdd6f4]">
            Últimos Tips <span class="text-[#8839ef] dark:text-[#cba6f7]">/blog</span>
          </h5>
          <Link href="/blog">
            Ver todo →
          </Link>
        </div>
        <ul class="flex flex-col gap-4">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between border-b border-[#dce0e8] dark:border-[#313244] pb-2">
          <h5 class="font-bold text-[#4c4f69] dark:text-[#cdd6f4]">
            Laboratorio <span class="text-[#8839ef] dark:text-[#cba6f7]">/projects</span>
          </h5>
          <Link href="/projects">
            Ver todo →
          </Link>
        </div>
        <ul class="flex flex-col gap-4">
          {projects.map(project => (
            <li>
              <ArrowCard entry={project} />
            </li>
          ))}
        </ul>
      </section>

      <section class="animate p-8 rounded-2xl bg-[#8839ef]/5 dark:bg-[#cba6f7]/5 border-2 border-[#8839ef]/10 dark:border-[#cba6f7]/10 space-y-4">
        <h5 class="font-bold text-[#8839ef] dark:text-[#cba6f7]">
          ¿Quieres más configuraciones?
        </h5>
        <p class="text-sm">
          Únete a la newsletter. Envío un tip técnico práctico cada semana. Directo a tu terminal (o bandeja de entrada).
        </p>
        <div class="flex flex-col sm:flex-row gap-2 pt-2">
          <input 
            type="email" 
            placeholder="admin@ejemplo.com" 
            class="flex-1 px-4 py-2 rounded-lg bg-white dark:bg-[#181825] border border-[#dce0e8] dark:border-[#313244] focus:ring-2 focus:ring-[#cba6f7] outline-none text-sm transition-all"
          />
          <button class="px-6 py-2 rounded-lg bg-[#4c4f69] dark:bg-[#cba6f7] text-[#eff1f5] dark:text-[#11111b] font-bold text-sm hover:opacity-90 transition-opacity">
            Suscribirme
          </button>
        </div>
      </section>

      <section class="animate space-y-4">
        <h5 class="font-bold text-[#4c4f69] dark:text-[#cdd6f4]">
          Hablemos
        </h5>
        <article>
          <p>
            Si tienes dudas sobre alguna configuración o quieres proponer un tema, encuéntrame en redes sociales o envíame un mail.
          </p>
        </article>
        <ul class="flex flex-wrap gap-2">
          {SOCIALS.map(SOCIAL => (
            <li class="flex gap-x-2 text-nowrap font-mono text-sm italic">
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME.toLowerCase()}
              </Link>
              {"/"}
            </li>
          ))}
          <li class="line-clamp-1 font-mono text-sm italic">
            <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
              {SITE.EMAIL}
            </Link>
          </li>
        </ul>
      </section>
    </div>
  </Container>
</PageLayout>